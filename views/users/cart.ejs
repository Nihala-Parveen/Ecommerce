<%- include('../layouts/header.ejs') %>

<section class="cart_area section_padding">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% let subtotal = 0 %>
            <% if (carts && carts.products) { %>
              <% carts.products.forEach((cart,index) => { %>
              <% const total = cart.price * cart.quantity %>
              <% subtotal += total %>
                <tr>
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img src="/uploads/<%= cart.productId.images[0] %>" alt="img" />
                      </div>
                      <div class="media-body">
                        <p><%= cart.productId.name %></p>
                      </div>
                    </div>
                  </td>
                  <td>
                    <h5>$<%= cart.price %></h5>
                  </td>
                  <td>
                    <form action="/editquantity" method="POST">
                      <input type="hidden" name="id" value="<%= cart.productId._id %>">
                      <input type="hidden" name="quantity" value="<%= cart.quantity %>">
                      <% if(cart.productId.stock > 0) { %>
                        <button class="bg-danger mr-3" type="submit" name="action" value="decrease">-</button>
                        <%= cart.quantity %>
                        <button class="bg-success ml-3" type="submit" name="action" value="increase">+</button>
                      <% } else { %>
                        <span class="text-danger">Out of stock</span>
                      <% } %>
                    </form>
                  </td>
                  <td>
                    <h5>$<%= total %></h5>
                  </td>
                  <td><a href="/removecart?id=<%= carts._id %>&productId=<%= cart.productId._id %>" class="text-danger"><i class="fa fa-trash "></i></a></td>
                </tr>
              <!-- <tr class="bottom_button">
                <td>
                  <a class="btn_1" href="#">Update Cart</a>
                </td>
                <td></td>
                <td></td>
                <td>
                  <div class="cupon_text float-right">
                    <a class="btn_1" href="#">Close Coupon</a>
                  </div>
                </td>
              </tr> -->
              <% }) %>
              <% } else { %>
                <p>No items in the cart.</p>
              <% } %>
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Subtotal</h5>
                </td>
                <td>
                  <h5>$<%= subtotal %></h5>
                </td>
              </tr>
              <!-- <tr class="shipping_area">
                <td></td>
                <td></td>
                <td>
                  <h5>Shipping</h5>
                </td>
                <td>
                  <div class="shipping_box">
                    <ul class="list">
                      <li>
                        Flat Rate: $5.00
                        <input type="radio" aria-label="Radio button for following text input">
                      </li>
                      <li>
                        Free Shipping
                        <input type="radio" aria-label="Radio button for following text input">
                      </li>
                      <li>
                        Flat Rate: $10.00
                        <input type="radio" aria-label="Radio button for following text input">
                      </li>
                      <li class="active">
                        Local Delivery: $2.00
                        <input type="radio" aria-label="Radio button for following text input">
                      </li>
                    </ul>
                    <h6>
                      Calculate Shipping
                      <i class="fa fa-caret-down" aria-hidden="true"></i>
                    </h6>
                    <select class="shipping_select">
                      <option value="1">Bangladesh</option>
                      <option value="2">India</option>
                      <option value="4">Pakistan</option>
                    </select>
                    <select class="shipping_select section_bg">
                      <option value="1">Select a State</option>
                      <option value="2">Select a State</option>
                      <option value="4">Select a State</option>
                    </select>
                    <input class="post_code" type="text" placeholder="Postcode/Zipcode" />
                    <a class="btn_1" href="#">Update Details</a>
                  </div>
                </td>
              </tr> -->
            </tbody>
          </table>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1" href="/productlist">Continue Shopping</a>
            <% if(carts && carts.products && carts.products.length > 0) { %> 
              <% const outOfStock = carts.products.some((cart)=>cart.productId.stock===0) %>
              <% console.log("outOfStock" , outOfStock) %>
              <% if(outOfStock){ %>
                <span class="btn_1 disabled">Proceed to checkout</span>
              <% } else { %>
                <a class="btn_1 checkout_btn_1" href="/checkout">Proceed to checkout</a>
              <% } %>
            <% } else { %> 
              <span class="btn_1 disabled">Proceed to checkout</span>
            <% } %>
          </div>
        </div>
      </div>
  </section>

<%- include('../layouts/footer.ejs') %>